@using Model
@model Model.ViewModel.UserViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<h2>Index</h2>
<a href="~/User/AddUser" class="btn btn-primary">Add User</a>

<table class="table table-bordered table-striped table-responsive">
    <thead>
        <tr>
            <th>UsersId</th>
            <th>Full Name</th>
            <th>Contact No</th>
            <th>Email</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.UserList)
        {
            <tr>
                <td>
                    @item.UserId
                </td>
                <td>
                    @item.Full_name
                </td>
                <td>
                    @item.ContactNo
                </td>
                <td>
                    @item.Email
                </td>
                <td>
                    <a class="btn btn-primary" href="~/User/EditUser?userId=@item.UserId">Edit</a>
                </td>
                <td>
                    <a class="btn btn-primary" data-toggle="modal" data-target="#myModal" onclick="OpenModal(@item.UserId)">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>



<div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
            Modal content

            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Delete Content</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group col-md-4">
                        Full Name
                        @Html.TextBoxFor(o => o.Full_name, new { @class = "form-control", @readonly=true })
                        @Html.HiddenFor(o => o.UserId)
                    </div>

                    <div class="form-group col-md-4">
                        Contact Number
                        @Html.TextBoxFor(o => o.ContactNo, new { @class = "form-control", @type = "number", @readonly = true })
                    </div>

                    <div class="form-group col-md-4">
                        Email
                        @Html.TextBoxFor(o => o.Email, new { @class = "form-control", @readonly = true })
                    </div>

                </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="DeleteUser();" >Delete</button>
            </div>
        </div>

        </div>
    </div>

<script>
    function OpenModal(UserId) {
        $.ajax({
            type: "GET",
            url: '@Url.Action("GetUserById", "User")',
            data: { UserId: UserId },
            success: function (data) {
                console.log(data);
                if (data != null) {
                    $('#myModal #UserId').val(data.UserId);
                    $('#myModal #Full_name').val(data.Full_name);
                    $('#myModal #ContactNo').val(data.ContactNo);
                    $('#myModal #Email ').val(data.Email);
                    $('#myModal').modal('show');
                }
            },
            error: function (err) {
            }
        })
    }

    function DeleteUser() {
        if (confirm("Are you sure you want to delete?") == true) {
            var UserId = $("#UserId").val();
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteUserById", "User")',
                data: { UserId: UserId },
                success: function (data) {
                    location.reload();
                },
                error: function (err) {
                }
            })

        } 
    }


</script>


